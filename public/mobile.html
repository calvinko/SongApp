<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
        <link href="css/font-awesome.css" rel="stylesheet" media="screen">
        <link href="css/songapp.css" rel="stylesheet" media="screen">
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" ></script>
        <script src="js/song.js" ></script>

    </head>
    <body>
        <script>




            function showSongText(bookname, songname, songtext, t) {
                $("#lyricsbox .bname").html(bookname);
                if (t == 7) {
                    $("#lyricsbox .lyrics").html(songtext);
                } else
                if (getSongTextType(songtext) > 1) {
                    $("#lyricsbox .lyrics").html("<pre style='font-size: 24px; line-height: 28px'>" + songname + "\n\n" + songtext + "</pre>");
                } else {
                    $("#lyricsbox .lyrics").html("<pre style='font-size: 18px; line-height: 20px'>" + songname + "\n\n" + songtext + "</pre>");
                }
                $(".contentbox").hide();
                $("#lyricsbox").show();
            }

            function showSongBook(sbook) {
                $("#booktitle").text(sbook.name);
                data = sbook.getData();

                $("#songindex").empty();
                $.each(data, function(num, val) {
                    let pmark = "";
                    let attribute = 0;
                    let elm;
                    if (val.pagenum != '0' && attribute > 2) {
                        pmark = $("<span style='float:right; height:32px'>p. " + val.pagenum + "</span>")
                    }
                    if (attribute > 0) {
                        elm = $("<a href='#'>" + val.songnum + ". " + val.songname + "</a>");
                    } else {
                        elm = $("<a href='#'>" + val.songname + "</a>");
                    }
                    elm.append(pmark);
                    elm.click(function(ev){
                        showSongText(sbook.name, val.songname, val.songtext, val.type);
                        window.location.hash = sbook.id + '-' + val.songnum;
                        ev.preventDefault();
                    })
                    $("#songindex").append($("<div class='songindexentry'></div>").append(elm));
                });
                $(".contentbox").hide();
                $("#songindex").show();

            }


            var songstore;
            $(function() {
                songstore = new SongStore();
                songstore.loadBookList().then(
                    function (store) {
                        $.each(store.getBookList(), function (bid, val) {
                            var elm = $("<a href='#'>" + val.name + "</a>");
                            elm.attr("bookid", bid);
                            elm.click(function (ev) {
                                store.loadSongBook(bid).then(
                                    showSongBook
                                );
                            });
                            $("#m-nav-songbook").append($("<li class='songindexentry'></li>").append(elm));
                        })

                    },
                    function (store) {
                        return;
                    }
                );

                $(".atab").click(function () {
                    var tid = $(this).attr("tid");
                    $(".contentbox").hide();
                    $("#" + tid).show();
                })

                $("#bt-prev").click(function () {
                    songstore.currentBook.loadprev();
                });

                $("#bt-next").click(function () {
                    songstore.currentBook.loadnext();
                });

                $("#btincfont").click(function () {
                    var fontSize = $("#lyricsbox pre").css('font-size').split('px')[0];
                    var fontInt = parseInt(fontSize) + 1;
                    if (fontInt > 36) fontInt = 36;
                    var lineHeight = fontInt + 4;
                    fontSize = fontInt + 'px';
                    $("#lyricsbox pre").css('font-size', fontSize);
                    $("#lyricsbox pre").css('line-height', lineHeight + 'px');

                })

                $("#btdecfont").click(function () {
                    var fontSize = $("#lyricsbox pre").css('font-size').split('px')[0];
                    var fontInt = parseInt(fontSize) - 1;
                    if (fontInt < 10) fontInt = 10;
                    var lineHeight = fontInt + 4;
                    fontSize = fontInt + 'px';
                    $("#lyricsbox pre").css('font-size', fontSize);
                    $("#lyricsbox pre").css('line-height', lineHeight + 'px');

                })
            });
      </script>

      <div class="ktabbar">
          <div style="width: 40px;" class="ktab"><a href=""><i style="padding-top:4px;" class="icon-home"></i></a></div>
          <div id="hymntab" tid="hymn" class="ktab atab">Library</div>
          <div id="songindextab" tid="songindex" class="ktab atab">Index</div>
          <div id="lyrictab" tid="lyricsbox" class="ktab atab">Lyrics</div>

      </div>
      <div id="hymn" class="contentbox">
          <ul id="m-nav-songbook" style="margin: 0px">
          </ul>
      </div>
      <div id="songindex" style="display:none" class="contentbox">
          <h3>Song Index</h3>
      </div>
      <div id="lyricsbox" style="display:none" class="contentbox">
          <div class='stitle'>
              <div class='bname'>SongBook</div>
              <div class='btn-group fontctrl'>
                  <a id="bt-prev" class="btn"><i class="icon-arrow-left"></i></a>
                  <a style="margin-right: 5px;" id="bt-next" class="btn"><i class="icon-arrow-right"></i></a>
                  <a id ="btincfont" class="btn"><i class="icon-font"></i><i class="icon-caret-up"></i></a>
                  <a id ="btdecfont" class="btn"><i class="icon-font"></i><i class="icon-caret-down"></i></a>
              </div>
          </div>
          <div class="lyrics">
          </div>

      </div>
  </body>

